# 3. 课程内容提要

我们将使用 Flutter 来实现 Android 和 iOS 版的棋路-中国象棋。它目前在 Apple 的 AppStore 和 Google Play 都已上线，欢迎你搜索「棋路 中国象棋」快速体验它们。

![&#x5728; AppStore &#x5B89;&#x88C5;&#x300C;&#x68CB;&#x8DEF;-&#x4E2D;&#x56FD;&#x8C61;&#x68CB;&#x300D;](.gitbook/assets/xia-zai-1.gif)

![&#x68CB;&#x8DEF;-&#x4E2D;&#x56FD;&#x8C61;&#x68CB;&#x4EBA;&#x673A;&#x5BF9;&#x6218;](.gitbook/assets/xia-zai-2.gif)



## 棋路-中国象棋游戏主要 Feature

* 人机对战
* 人与云库服务器对战
* 分析棋盘局面，给出多种推荐招着，并评估各着法的得分
* 在线棋谱搜索
* XQF 棋谱格式解析
* 阅读棋谱内容

## 实现游戏过程，你将学习到

* Flutter 基础知识
  * 组件及布局知识
  * 手势检测
  * Providers 机制
  * Http 通信
  * Canvas 绘制
  * Method Channel 与原生应用通信
  * 动画
  * 音乐、音效
  * 用户配置
  * 多种设备屏幕适配
* 象棋软件开发知识
  * 象棋的基本规则
  * 象棋着法枚举和有效性判断
  * 长捉和胜负检测
  * FEN 局面表示
  * UCCI 引擎通信协议
  * XQF 象棋棋谱格式的解析
* Native 开发知识
  * 在 iOS 和 Android 中访问 Flutter 资源包
  * iOS 中 Object C 与 C++ 的混合开发
  * iOS 的多线程通信
  * Android 中 Java 与 C++ 通过 JNI 协同
  * Android 的多线程通信

一个完整的产品涉及到的细节比较多，有些特定场景到我们遇到时再和大家分解。

## 内容大纲

### 1. 从哪儿开始

* 确认开发环境
* 创建项目
* 添加 git 版本控制
* 关于颜色的使用约定

### 2. 先画它一个棋盘

* 棋盘规划
* 添加 Board Widget
* Canvas 绘图

### 3. 棋盘怎能缺少棋子

* 象棋局面表示
* 棋子绘制
* Board Widget 重构
* 添加中国风字体

### 4. 让棋盘支持行棋动作

* 棋盘手势检测
* 象棋坐标系
* 棋盘子力变动

### 5. 实现游戏的 UI 骨架

* 添加游戏主菜单
* 实现对战页面
* 适配各种比例屏幕

### 6. 使用云库进行人机对战

* 象棋云库引入
* 封装云库 API
* 棋软 UCCI、FEN 通用接口
* 人机交替行棋控制

### 7. 完善象棋对战功能

* 行棋着法合法性判断
* 胜负和结果检测

### 8. 提升游戏体验

* 美化主要页面
* 添加游戏动效
* 添加背景音乐和音效

### 9. 引入开源单机引擎

* 选择 C/C++ 开源引擎
* 配合引擎调整项目组织
* 规划引擎与 Flutter 界面程序间的接口
* 实现 Flutter 侧的引擎查询

### 10. 封装 iOS 原生引擎

* 修改引擎代码以适应移动编译环境
* 创建与引擎之间的沟通 Channel
* 引擎多进程与多线程工作模式选择
* 实现 Flutter Method Channle 接口功能

### 11. 封装 Android 原生引擎

* 重构以使用适当的 Android 包名
* 创建 Native 类对接 Flutter 接口
* 创建 JNI 方法签名
* 配置 cmake 的 NDK 编译环境
* Android 平台引擎多线程工作模式
* 实现 Flutter Method Channle 接口功能

### 12. 记谱以提供悔棋功能

* 重构选棋逻辑，保存每步选框记录
* 提供回退到任意历史局面功能

### 13. 提供基于云库的局面分析

* 封装象棋云库接口
* 查询局面的分析数据

### 14. 添加游戏设置

* 配置工具类的实现
* 调整人机对战难度
* 音乐、音效开关

### 15. 为发布作准备

* iOS 发布工作
* Android 发布工作

## 16. 后记

* Flutter 在这个项目中的优点
* Flutter 在这个项目中的坑点
* 下一步

